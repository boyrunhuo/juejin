<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    
</body>
<script>
    /**
    promise:

    */

    function myPromise(constructor) {
        let self = this
        self.status = 'pending'//定义初始状态
        self.value = undefined //定义状态为resolved时的值
        self.reason = undefined //定义状态为rejected时的值
        function resolve(value) {
            if(self.status === 'pending') {
                self.value = value
                self.status = 'resolved'
            }
        }

        function reject(reason) {
            if(self.status === 'pending') {
                self.reason=reason
                self.status = 'rejected'
            }
        }

        try {
            constructor(resolve,reject)
        } catch(e) {
            reject(e)
        }
    }

    //定义then方法
    myPromise.prototype.then = function(onFullfilled,onRejected) {
        let self = this
        switch(self.status) {
            case 'resolved':
                onFullfilled(self.value)
                break;
            case 'rejected':
                onRejected(self.reason)
                break
            default:
                break
        }
    }

    var p = new myPromise(function(resolve,reject){
        // resolve(1)
        reject(2)
    })

    p.then(function(x) {
        console.log('x',x)
    },function(y) {
        console.log('y',y);
    })
</script>
</html>